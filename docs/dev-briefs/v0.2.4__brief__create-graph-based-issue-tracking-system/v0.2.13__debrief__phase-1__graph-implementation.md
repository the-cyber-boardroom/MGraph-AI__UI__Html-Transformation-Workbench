# Graph-Based Issue Tracking: Phase 1 implementation Debrief

**Version:** v0.2.13  
**Date:** January 31, 2026  
**Status:** Phase 1 Complete

---

## Executive Summary

This document captures the decisions made and work completed implementing the graph-based issue tracking system. The implementation synthesizes requirements from three development briefs into a cohesive, type-safe architecture using Memory-FS for storage abstraction.

---

## Source Briefs Reviewed

| Brief | Version | Focus |
|-------|---------|-------|
| `v0.2.2__backend-brief__issue-tracking-api.md` | v0.2.2 | Simple file-based CRUD (superseded) |
| `v0.2.4__brief__graph-based-issue-tracking.md` | v0.2.4 | Graph nodes/edges architecture |
| `v0.2.4__brief__memory-fs-integration.md` | v0.2.4 | Storage abstraction layer |

---

## Key Architectural Decisions

### 1. Graph Model Over Flat Files

**Decision:** Implemented graph-based model with typed nodes and bidirectional edges.

**Rationale:** The v0.2.2 brief proposed simple JSON files per issue. Analysis revealed this would not scale for:
- Cross-referencing between issues (blocks, depends-on)
- Agent task assignment tracking
- Hierarchical relationships (feature → task → bug)

**Implementation:**
- Every entity is a `Schema__Node` with `node_id`, `node_type`, `label`
- Relationships stored as `Schema__Node__Link` arrays on both endpoints
- Link types define verb/inverse_verb pairs for semantic clarity

### 2. Triple Identity Model

**Decision:** Each node has three identity components.

| Identity | Purpose | Example |
|----------|---------|---------|
| `node_id` | Machine use (Obj_Id) | `a1b2c3d4e5` |
| `node_index` | Per-type counter | `27` |
| `label` | Human-readable | `Bug-27` |

**Rationale:** 
- `node_id` enables stable references even if labels change
- `label` provides GitHub-browsable filenames and human UX
- `node_index` ensures sequential, predictable numbering per type

### 3. Memory-FS Storage Abstraction

**Decision:** All data access through Memory-FS, never direct file I/O.

**Rationale:** The v0.2.4 Memory-FS brief specified backend-agnostic storage. This enables:
- In-memory backend for tests (instant, no cleanup)
- Local disk for development (Git-tracked)
- SQLite for embedded deployments
- ZIP for export/archive

**Implementation:**
```
Graph__Repository__Factory.create_memory()      # Tests
Graph__Repository__Factory.create_local_disk()  # Development
Graph__Repository__Factory.create_sqlite()      # Production
Graph__Repository__Factory.create_zip()         # Export
```

### 4. Bidirectional Denormalized Links

**Decision:** Links stored on BOTH source and target nodes.

**Rationale:** The brief specified bidirectional relationships. Options considered:

| Option | Pros | Cons |
|--------|------|------|
| Central edge table | Single source of truth | Extra lookup for node's links |
| Source-only storage | Simple writes | Expensive "who links to me?" queries |
| **Bidirectional** | Fast reads both directions | Must maintain consistency |

**Implementation:** `Link__Service.create_link()` writes to both nodes atomically. Inverse verb automatically derived from `Schema__Link__Type`.

### 5. Type-Safe Schema Design

**Decision:** One class per file, pure data containers, no methods in schemas.

**Rationale:** Following Type_Safe guidance:
- Schemas are serialization boundaries
- Business logic belongs in Service classes
- Enables clean JSON round-tripping

**Files Created:**
```
Schema__Node.py                    # Core node structure
Schema__Node__Link.py              # Relationship edge
Schema__Node__Type.py              # Type definition
Schema__Link__Type.py              # Link type definition
Schema__Property__Definition.py    # Custom fields
Schema__Type__Index.py             # Per-type index
Schema__Global__Index.py           # Global index
Schema__Attachment.py              # File metadata
+ 10 Request/Response schemas
```

### 6. Default Type Configuration

**Decision:** Initialize with opinionated defaults, allow customization.

**Default Node Types:**
| Type | Color | Default Status | Use Case |
|------|-------|----------------|----------|
| bug | #ef4444 | backlog | Defects |
| task | #3b82f6 | backlog | Work units |
| feature | #22c55e | proposed | Capabilities |
| person | #8b5cf6 | active | Agents/humans |

**Default Link Types:**
| Verb | Inverse | Constraints |
|------|---------|-------------|
| blocks | blocked-by | bug/task → task/feature |
| has-task | task-of | feature → task |
| assigned-to | assignee-of | bug/task/feature → person |
| depends-on | dependency-of | task/feature → task/feature |
| relates-to | relates-to | any → any (symmetric) |

### 7. Label-Based API Routing

**Decision:** Primary API access via human-readable labels, not GUIDs.

```
GET  /api/nodes/Bug-27           # Not /api/nodes/a1b2c3d4e5
POST /api/nodes/Bug-27/links     # Link operations by label
```

**Rationale:**
- URLs are self-documenting
- Matches GitHub file browsing (`.issues/data/bug/Bug-27/node.json`)
- Label parsing extracts type: `Bug-27` → `bug`

---

## Deviations from Briefs

### 1. Simplified Directory Structure

**Brief specified:**
```
.issues/data/{node_type}/{Label}/
├── node.json
├── attachments/
└── history/
```

**Implemented:**
```
.issues/data/{node_type}/{Label}/
├── node.json
└── attachments/
```

**Reason:** History tracking deferred to Phase 2. Current implementation updates `updated_at` timestamp but doesn't maintain revision history.

### 2. Single-File JSON Mode Not Implemented

**Brief specified:** Memory-FS single-file JSON mode for Git browsability.

**Status:** Deferred. Current implementation uses standard Memory-FS file operations. Single-file mode would consolidate all data into one JSON for simpler Git diffs.

### 3. Attachment Compression Pipeline

**Brief specified:** Image compression (max 1920px, JPEG quality 85).

**Status:** Deferred to Phase 3. Current `attachment_save()` stores raw bytes without processing.

---

## Immediate Fixes Applied

Two bugs identified in existing v0.2.2 codebase were fixed:

### Fix 1: Field Name Mismatch
```python
# BEFORE (wrong)
index.statusCounts = counts    # camelCase

# AFTER (correct)  
index.status_counts = counts   # snake_case matching schema
```

### Fix 2: Inconsistent Message Type
```python
# BEFORE (inconsistent)
message : str = ''             # Raw primitive

# AFTER (consistent)
message : Safe_Str__Text = ''  # Type-safe
```

---

## Test Coverage

**Approach:** Real services with in-memory storage, no mocks.

| Test File | Class Under Test | Tests |
|-----------|-----------------|-------|
| `test_Path__Handler__Graph_Node.py` | Path generation | 25 |
| `test_Graph__Repository.py` | Data access | 35 |
| `test_Graph__Repository__Factory.py` | Backend factory | 20 |
| `test_Node__Service.py` | Node CRUD | 30 |
| `test_Link__Service.py` | Relationships | 25 |
| `test_Type__Service.py` | Type management | 30 |
| `test_Routes__Nodes.py` | Node endpoints | 15 |
| `test_Routes__Links.py` | Link endpoints | 15 |
| `test_Routes__Types.py` | Type endpoints | 25 |

**Total: ~220 tests**

---

## Files Delivered

```
graph_schemas/           # 23 schema files
├── Schema__Node.py
├── Schema__Node__Link.py
├── Schema__Node__Type.py
├── Schema__Link__Type.py
├── Schema__Property__Definition.py
├── Schema__Type__Index.py
├── Schema__Type__Summary.py
├── Schema__Global__Index.py
├── Schema__Attachment.py
├── Schema__Node__Summary.py
├── Schema__Node__Create__Request.py
├── Schema__Node__Create__Response.py
├── Schema__Node__Update__Request.py
├── Schema__Node__Update__Response.py
├── Schema__Node__Delete__Response.py
├── Schema__Node__List__Response.py
├── Schema__Link__Create__Request.py
├── Schema__Link__Create__Response.py
├── Schema__Link__Delete__Response.py
├── Schema__Link__List__Response.py
└── safe_str/
    └── Safe_Str__Graph_Types.py

graph_services/          # 6 service files
├── Path__Handler__Graph_Node.py
├── Graph__Repository.py
├── Graph__Repository__Factory.py
├── Node__Service.py
├── Link__Service.py
└── Type__Service.py

graph_routes/            # 3 route files
├── Routes__Nodes.py
├── Routes__Links.py
└── Routes__Types.py

tests/                   # 9 test files
fixes/                   # 2 patch files
```

---

## Remaining Work (Future Phases)

### Phase 2: Advanced Relationships
- [ ] Cascade delete links when node deleted
- [ ] Circular reference detection
- [ ] Path finding between nodes

### Phase 3: Attachments
- [ ] File upload endpoint
- [ ] Image compression pipeline
- [ ] Attachment metadata in node

### Phase 4: Graph Operations
- [ ] Full graph export
- [ ] Subgraph extraction
- [ ] Visualization data format

### Phase 5: Agent Integration
- [ ] Assignment workflows
- [ ] Status transition rules
- [ ] Activity logging

---

## Conclusion

The implementation successfully delivers a type-safe, storage-agnostic graph-based issue tracking foundation. Key wins:

1. **Clean separation** - Schemas, Services, Routes, Repository layers
2. **Test confidence** - 220+ tests with real services, no mocks
3. **Flexibility** - Swap storage backends without code changes
4. **Extensibility** - Add new node/link types via config, not code

The architecture is ready for UI development and agent integration.