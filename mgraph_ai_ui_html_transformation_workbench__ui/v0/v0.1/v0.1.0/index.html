<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML Transformation Workbench</title>
    <link rel="stylesheet" href="css/shell.css">
</head>
<body>
    <!-- Services load first (order matters!) -->
    <script src="js/event-bus.js"></script>
    <script src="js/config-manager.js"></script>
    <script src="js/api-client.js"></script>

    <!-- Shell and nav bar -->
    <script src="components/shell/nav-bar.js"></script>
    <script src="components/shell/workbench-shell.js"></script>

    <!-- Mini apps (Phase 1 - Hello World validation) -->
    <script src="components/hello-world-1/hello-world-1.js"></script>
    <script src="components/hello-world-2/hello-world-2.js"></script>

    <!-- Mini apps (Phase 2 - Debug Tools & Settings) -->
    <script src="components/settings-panel/settings-panel.js"></script>
    <script src="components/events-viewer/events-viewer.js"></script>
    <script src="components/api-logger/api-logger.js"></script>

    <!-- Mini apps (Phase 3 - Core Functionality) -->
    <script src="components/html-workbench/html-workbench.js"></script>
    <script src="components/api-explorer/api-explorer.js"></script>
    <script src="components/profile-manager/profile-manager.js"></script>
    <script src="components/site-browser/site-browser.js"></script>

    <!-- Initialize the shell -->
    <workbench-shell></workbench-shell>

    <!-- Register mini apps -->
    <script>
        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', function() {
            // Register Phase 3 - Core Functionality (main features first)
            window.workbench.router.register(HtmlWorkbench);
            window.workbench.router.register(SiteBrowser);
            window.workbench.router.register(ProfileManager);
            window.workbench.router.register(ApiExplorer);

            // Register Phase 2 - Settings and Debug Tools
            window.workbench.router.register(SettingsPanel);
            window.workbench.router.register(EventsViewer);
            window.workbench.router.register(ApiLogger);

            // Register Phase 1 validation apps (for testing/development)
            window.workbench.router.register(HelloWorld1);
            window.workbench.router.register(HelloWorld2);

            // Add version switcher to header
            const header = document.querySelector('.shell-header');
            if (header) {
                const switcher = document.createElement('div');
                switcher.className = 'version-switcher';
                switcher.style.cssText = 'margin-left:auto;display:flex;align-items:center;gap:8px;';
                switcher.innerHTML = `
                    <label style="font-size:11px;color:rgba(255,255,255,0.7);">Version:</label>
                    <select id="version-select" style="padding:4px 8px;border:1px solid rgba(255,255,255,0.3);border-radius:4px;background:rgba(255,255,255,0.1);color:#fff;font-size:11px;cursor:pointer;">
                        <option value="v0.1.0" selected>v0.1.0 (Base)</option>
                        <option value="v0.1.1">v0.1.1 (Analysis)</option>
                        <option value="v0.1.2">v0.1.2 (UI)</option>
                        <option value="v0.1.3">v0.1.3 (Latest)</option>
                    </select>
                `;
                header.appendChild(switcher);

                document.getElementById('version-select').addEventListener('change', function(e) {
                    const basePath = window.location.pathname.replace(/v0\.1\.\d+\/index\.html$/, '');
                    window.location.href = basePath + e.target.value + '/index.html';
                });
            }
        });
    </script>
</body>
</html>
